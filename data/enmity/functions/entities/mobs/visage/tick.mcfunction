execute if entity @s[tag=enmity.crimson] run particle crimson_spore ~ ~0.5 ~ 0.3 0.3 0.3 0 2
execute if entity @s[tag=enmity.warped] run particle warped_spore ~ ~0.5 ~ 0.3 0.3 0.3 0 2
execute if entity @s[tag=enmity.crimson] run particle dust_color_transition 1 1 1 0.75 1 0.1 0.25 ~ ~0.5 ~ 0.3 0.3 0.3 0 3
execute if entity @s[tag=enmity.warped] run particle dust_color_transition 1 1 1 0.75 0.25 0.1 1 ~ ~0.5 ~ 0.3 0.3 0.3 0 3
tag @s add enmity.close_to_ground
execute if block ~0.15 ~ ~0.15 #enmity:nimbus_flight if block ~0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~0.15 ~-1 ~0.15 #enmity:nimbus_flight if block ~0.15 ~-1 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~-1 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~-1 ~-0.15 #enmity:nimbus_flight if block ~0.15 ~-2 ~0.15 #enmity:nimbus_flight if block ~0.15 ~-2 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~-2 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~-2 ~-0.15 #enmity:nimbus_flight if block ~0.15 ~-3 ~0.15 #enmity:nimbus_flight if block ~0.15 ~-3 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~-3 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~-3 ~-0.15 #enmity:nimbus_flight if block ~0.15 ~-4 ~0.15 #enmity:nimbus_flight if block ~0.15 ~-4 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~-4 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~-4 ~-0.15 #enmity:nimbus_flight if block ~0.15 ~-5 ~0.15 #enmity:nimbus_flight if block ~0.15 ~-5 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~-5 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~-5 ~-0.15 #enmity:nimbus_flight run tag @s remove enmity.close_to_ground
execute if entity @s[tag=enmity.close_to_ground] run effect give @s levitation 1 0 true
execute unless entity @s[tag=enmity.close_to_ground] if predicate enmity:random/random_0.5 run effect clear @s levitation
tag @s remove enmity.close_to_ground
execute if entity @s[tag=enmity.has_view,tag=!enmity.obstructed] if score %difficulty enmity.value matches 1 facing entity @p[gamemode=!creative,gamemode=!spectator,distance=7..32] eyes positioned ^ ^0.04 ^0.15 if block ~0.15 ~ ~0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~0.15 #enmity:nimbus_flight if block ~0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~0.15 ~0.975 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~0.975 ~0.15 #enmity:nimbus_flight if block ~0.15 ~0.975 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~0.975 ~-0.15 #enmity:nimbus_flight run tp @s ~ ~ ~ facing entity @p[gamemode=!creative,gamemode=!spectator]
execute if entity @s[tag=enmity.has_view,tag=!enmity.obstructed] if score %difficulty enmity.value matches 2 facing entity @p[gamemode=!creative,gamemode=!spectator,distance=7..64] eyes positioned ^ ^0.065 ^0.22 if block ~0.15 ~ ~0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~0.15 #enmity:nimbus_flight if block ~0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~0.15 ~0.975 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~0.975 ~0.15 #enmity:nimbus_flight if block ~0.15 ~0.975 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~0.975 ~-0.15 #enmity:nimbus_flight run tp @s ~ ~ ~ facing entity @p[gamemode=!creative,gamemode=!spectator]
execute if entity @s[tag=enmity.has_view,tag=!enmity.obstructed] facing entity @p[gamemode=!creative,gamemode=!spectator,distance=..7] eyes positioned ^ ^ ^-1 run summon marker ~ ~ ~ {Tags:["enmity.direction_anchor"]}
execute if entity @s[tag=enmity.has_view,tag=!enmity.obstructed] run data modify entity @e[type=marker,tag=enmity.direction_anchor,limit=1] Pos[1] set from entity @s Pos[1]
execute if entity @s[tag=enmity.has_view,tag=!enmity.obstructed] facing entity @e[type=marker,tag=enmity.direction_anchor,limit=1] feet positioned ^ ^0.1 ^0.2 if block ~0.15 ~ ~0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~0.15 #enmity:nimbus_flight if block ~0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~ ~-0.15 #enmity:nimbus_flight if block ~0.15 ~0.975 ~0.15 #enmity:nimbus_flight if block ~-0.15 ~0.975 ~0.15 #enmity:nimbus_flight if block ~0.15 ~0.975 ~-0.15 #enmity:nimbus_flight if block ~-0.15 ~0.975 ~-0.15 #enmity:nimbus_flight run tp @s ~ ~ ~ facing entity @p[gamemode=!creative,gamemode=!spectator]
kill @e[type=marker,tag=enmity.direction_anchor]
execute if entity @s[nbt={HurtTime:9s}] run function enmity:entities/mobs/visage/on_harm